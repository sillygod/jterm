#!/bin/bash
# Web Terminal Ebook Viewer (bookcat)
# Usage: bookcat <pdf_or_epub_file>

if [ -z "$1" ]; then
    echo "Usage: bookcat <pdf_or_epub_file>"
    echo "Supported formats: PDF, EPUB"
    exit 1
fi

FILE_PATH="$1"

# Check if file exists
if [ ! -f "$FILE_PATH" ]; then
    echo "Error: File not found: $FILE_PATH"
    exit 1
fi

# Get absolute path
ABS_PATH=$(realpath "$FILE_PATH" 2>/dev/null || readlink -f "$FILE_PATH" 2>/dev/null || echo "$FILE_PATH")

# Get file extension
EXT="${FILE_PATH##*.}"
EXT_LOWER=$(echo "$EXT" | tr '[:upper:]' '[:lower:]')

# Check if it's a supported ebook format
case "$EXT_LOWER" in
    pdf|epub)
        # Send OSC sequence to trigger web terminal ebook viewer
        printf '\033]1338;ViewEbook=%s\007' "$ABS_PATH"
        ;;
    *)
        echo "Error: Unsupported ebook format: $EXT_LOWER"
        echo "Supported formats: pdf, epub"
        exit 1
        ;;
esac
